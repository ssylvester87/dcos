endpoint_tests:
######### /system/health/
# there are differences in how upstreams are configured between EE and Open,
# hence the tests separation
  - tests:
      is_upstream_correct:
        test_paths:
          - /system/health/v1/foo/bar
        upstream: http:///run/dcos/dcos-diagnostics.sock
    type:
      - master
      - agent
######### /ca/
  - tests:
      is_unauthed_access_permitted:
        locations:
          - /ca/dcos-ca.crt
          - /ca/cacerts.jks
      are_upstream_req_headers_ok:
        skip_authcookie_filtering_test: false
        jwt_should_be_forwarded: false
        test_paths:
          - /ca/api/v2/info
          - /ca/api/v2/bundle
          - /ca/api/v2/newcert
          - /ca/api/v2/certificates
          - /ca/api/v2/newkey
          - /ca/api/v2/sign
      is_upstream_correct:
        test_paths:
          - /ca/api/v2/info
          - /ca/api/v2/bundle
          - /ca/api/v2/newcert
          - /ca/api/v2/certificates
          - /ca/api/v2/newkey
          - /ca/api/v2/sign
        upstream: http://127.0.0.1:8888
      is_upstream_req_ok:
        expected_http_ver: HTTP/1.0
        test_paths:
          - expected: /ca/api/v2/certificates
            sent: /ca/api/v2/certificates
          - expected: /ca/api/v2/bundle
            sent: /ca/api/v2/bundle
          - expected: /ca/api/v2/info
            sent: /ca/api/v2/info
          - expected: /ca/api/v2/newcert
            sent: /ca/api/v2/newcert
          - expected: /ca/api/v2/newkey
            sent: /ca/api/v2/newkey
          - expected: /ca/api/v2/sign
            sent: /ca/api/v2/sign
    type:
      - master
######### /acs/api/v1/:
# a) /acs/api/v1 <- covered in common tests
# b) ^/acs/api/v1/auth/(login|logout|jwks|providers|oidc/callback|oidc/providers/?|saml/providers/?)$
# c) ^/acs/api/v1/auth/saml/providers/[0-9a-zA-Z-]+/acs-callback$
# d) ^/acs/api/v1/users/(?<uid_path>.*)/permissions$
  - tests:
      is_unauthed_access_permitted:
        locations:
          # b) + c)
          - /acs/api/v1/auth/jwks
          - /acs/api/v1/auth/login
          - /acs/api/v1/auth/logout
          - /acs/api/v1/auth/oidc/callback
          - /acs/api/v1/auth/oidc/providers/
          - /acs/api/v1/auth/providers
          - /acs/api/v1/auth/saml/providers/
          - /acs/api/v1/auth/saml/providers/foobar-provider/acs-callback
      are_response_headers_ok:
        nocaching_headers_are_sent: true
        test_paths:
          # d)
          - /acs/api/v1/users/reflecting-user/permissions
      are_upstream_req_headers_ok:
        skip_authcookie_filtering_test: false
        jwt_should_be_forwarded: true
        test_paths:
          # b) + c)
          - /acs/api/v1/auth/jwks
          - /acs/api/v1/auth/login
          - /acs/api/v1/auth/logout
          - /acs/api/v1/auth/oidc/callback
          - /acs/api/v1/auth/oidc/providers/
          - /acs/api/v1/auth/providers
          - /acs/api/v1/auth/saml/providers/
          - /acs/api/v1/auth/saml/providers/foobar-provider/acs-callback
          # d)
          - /acs/api/v1/users/reflecting-user/permissions
      is_upstream_correct:
        test_paths:
          # b) + c)
          - /acs/api/v1/auth/jwks
          - /acs/api/v1/auth/login
          - /acs/api/v1/auth/logout
          - /acs/api/v1/auth/oidc/callback
          - /acs/api/v1/auth/oidc/providers/
          - /acs/api/v1/auth/providers
          - /acs/api/v1/auth/saml/providers/
          - /acs/api/v1/auth/saml/providers/foobar-provider/acs-callback
          # d)
          - /acs/api/v1/users/reflecting-user/permissions
        upstream: http://127.0.0.1:8101
      is_upstream_req_ok:
        expected_http_ver: HTTP/1.0
        test_paths:
          # b) + c)
          - sent: /acs/api/v1/auth/jwks
            expected: /acs/api/v1/auth/jwks
          - sent: /acs/api/v1/auth/login
            expected: /acs/api/v1/auth/login
          - sent: /acs/api/v1/auth/logout
            expected: /acs/api/v1/auth/logout
          - sent: /acs/api/v1/auth/oidc/callback
            expected: /acs/api/v1/auth/oidc/callback
          - sent: /acs/api/v1/auth/oidc/providers/
            expected: /acs/api/v1/auth/oidc/providers/
          - sent: /acs/api/v1/auth/providers
            expected: /acs/api/v1/auth/providers
          - sent: /acs/api/v1/auth/saml/providers/
            expected: /acs/api/v1/auth/saml/providers/
          - sent: /acs/api/v1/auth/saml/providers/foobar-provider/acs-callback
            expected: /acs/api/v1/auth/saml/providers/foobar-provider/acs-callback
          # d)
          - sent: /acs/api/v1/users/reflecting-user/permissions
            expected: /acs/api/v1/users/reflecting-user/permissions
    type:
      - master
######### /secrets
  - tests:
      are_upstream_req_headers_ok:
        skip_authcookie_filtering_test: false
        jwt_should_be_forwarded: true
        test_paths:
          - /secrets/v1/foo/bar
      is_upstream_correct:
        test_paths:
          - /secrets/v1/foo/bar
        upstream: http://127.0.0.1:1337
      is_upstream_req_ok:
        expected_http_ver: HTTP/1.0
        test_paths:
          - expected: /secrets/v1/foo/bar
            sent: /secrets/v1/foo/bar
    type:
      - master
######### /vault
  - tests:
      are_upstream_req_headers_ok:
        skip_authcookie_filtering_test: false
        jwt_should_be_forwarded: false
        test_paths:
          - /vault/default/foo/bar
      is_upstream_correct:
        test_paths:
          - /vault/default/foo/bar
        upstream: http://127.0.0.1:8200
      is_upstream_req_ok:
        expected_http_ver: HTTP/1.0
        test_paths:
          - expected: /foo/bar
            sent: /vault/default/foo/bar
    type:
      - master
######### /networking
  - tests:
      are_upstream_req_headers_ok:
        skip_authcookie_filtering_test: false
        jwt_should_be_forwarded: skip
        test_paths:
          - /networking/api/v1/foo/bar
      is_upstream_correct:
        test_paths:
          - /networking/api/v1/foo/bar
        upstream: http://127.0.0.1:61430
      is_upstream_req_ok:
        expected_http_ver: HTTP/1.0
        test_paths:
          - expected: /foo/bar
            sent: /networking/api/v1/foo/bar
      are_response_headers_ok:
        nocaching_headers_are_sent: true
        test_paths:
          - /networking/api/v1/foo/bar
    type:
      - master
  - tests:
      is_unauthed_access_permitted:
        locations:
          - /dcos-metadata/ui-config.json
    type:
      - master
######### /system/v1/backup endpoint
  - tests:
      are_upstream_req_headers_ok:
        skip_authcookie_filtering_test: false
        jwt_should_be_forwarded: skip
        test_paths:
          - /system/v1/backup/foo/bar
      is_upstream_req_ok:
        expected_http_ver: HTTP/1.0
        test_paths:
          - expected: /foo/bar
            sent: /system/v1/backup/foo/bar
          - expected: /
            sent: /system/v1/backup/
      is_upstream_correct:
        test_paths:
          - /system/v1/backup/foo/bar
          - /system/v1/backup/
        upstream: http:///run/dcos/dcos-backup-master.sock
    type:
      - master
